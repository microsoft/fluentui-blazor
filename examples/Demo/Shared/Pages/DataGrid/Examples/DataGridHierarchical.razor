@using Microsoft.FluentUI.AspNetCore.Components
@using FluentUI.Demo.Shared.SampleData

<style>
	:root {
		--datagrid-hover-color: lightyellow;
	}

	.fluent-data-grid {
		--fluent-data-grid-resize-handle-color: var(--neutral-stroke-rest) !important;
		--fluent-data-grid-resize-handle-opacity: 1 !important;
	}

	.flag {
		height: 1rem;
		border: 1px solid var(--neutral-layer-3);
	}

	td {
		height: 38px!important
	}
</style>

<FluentDataGrid Items="@items.Where(i => !i.IsHidden).AsQueryable()" ShowHover="true" ResizableColumns="true">
	<TemplateColumn Title="Name" HierarchicalToggle="true">
		@if (context.Item.ContinentCode != null)
		{
			<img class="flag" src="_content/FluentUI.Demo.Shared/flags/@(context.Item.Code).svg" alt="Flag of @(context.Item.Code)" />
		}
		@context.Item.Name
	</TemplateColumn>
    <PropertyColumn Title="Gold" Property="@(i => i.Item.Medals.Gold)" />
	<PropertyColumn Title="Silver" Property="@(i => i.Item.Medals.Silver)" />
	<PropertyColumn Title="Bronze" Property="@(i => i.Item.Medals.Bronze)" />
	<PropertyColumn Title="Total" Property="@(i => i.Item.Medals.Total)" />

</FluentDataGrid>

@code {
	List<OlympicGridItem> items = new();

	protected override void OnInitialized()
	{
		foreach (var continent in DataSource.Continents)
		{
			var countries = DataSource._olympics_2024.Where(c => c.ContinentCode == continent.Code).OrderByDescending(c => c.Medals.Total);

			var continentItem = new OlympicGridItem
			{
				Item = continent with
				{
					Medals = new Medals()
					{
						Gold = countries.Sum(c => c.Medals.Gold),
						Silver = countries.Sum(c => c.Medals.Silver),
						Bronze = countries.Sum(c => c.Medals.Bronze),
					}
				},
				IsCollapsed = true
			};

			items.Add(continentItem);

            foreach (var country in countries)
            {
                var countryItem = new OlympicGridItem
                {
                    Item = country,
                    Depth = 1,
                    IsHidden = true
                };
                continentItem.Children.Add(countryItem);
                items.Add(countryItem);
            }
        }
    }

    public class OlympicGridItem : HierarchicalGridItem<Country, OlympicGridItem>
    {
    }
}
