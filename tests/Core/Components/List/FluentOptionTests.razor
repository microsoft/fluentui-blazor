@using Microsoft.FluentUI.AspNetCore.Components.Utilities
@using Xunit;
@using Microsoft.FluentUI.AspNetCore.Components.Tests.Samples;
@inherits FluentUITestContext
@code
{
    private readonly IEnumerable<string?> Digits = new[] { null, "One", "Two", "Three" };

    private enum MyDigitsEnum
    {
        One,
        Two,
        Three
    }

    public FluentOptionTests()
    {
        JSInterop.Mode = JSRuntimeMode.Loose;
        Services.AddFluentUIComponents();
    }

    [Fact]
    public void FluentOption_Default()
    {
        // Arrange and Act
        var cut = Render(@<FluentOptionString Text="One" Value="One" />);
        // Assert
        cut.Verify();
    }

    [Fact]
    public void FluentOption_Disabled()
    {
        // Arrange and Act
        var cut = Render(@<FluentOptionString Text="One" Value="One" Disabled="true" />);
        // Assert
        cut.Verify();
    }

    [Fact]
    public void FluentOption_Selected()
    {
        // Arrange and Act
        var cut = Render(@<FluentOptionString Text="One" Value="One" Selected="true" />);
        // Assert
        cut.Verify();
    }

    [Fact]
    public void FluentOption_Description()
    {
        // Arrange and Act
        var cut = Render(@<FluentOptionString Text="One" Value="One" Description="Description" />);
        // Assert
        cut.Verify();
    }

    [Fact]
    public void FluentOption_StartSlot()
    {
        // Arrange and Act
        var cut = Render(@<FluentOptionString Text="One" Value="One">
            <FluentAvatar Size="AvatarSize.Size16" Color="AvatarColor.Blue" Slot="@FluentSlot.Start">16</FluentAvatar>
        </FluentOptionString>);

        // Assert
        cut.Verify();
    }

    [Fact]
    public void FluentOption_ThrowsException_WhenTypeMismatchWithParentList()
    {
        // Arrange & Act & Assert
        // This test validates that when a FluentOption<TValue> has a different type parameter
        // than the parent FluentSelect<TValue>, an InvalidOperationException is thrown
        // during OnInitializedAsync when InternalListContext is null but InternalListContextBase is not.
        var exception = Assert.Throws<InvalidOperationException>(() =>
        {
            Render(@<FluentSelect TOption="string" TValue="string">
                <FluentOption TValue="int" Value="123" Text="Invalid Type" />
            </FluentSelect>);
        });

        // Assert
        Assert.Contains("does not match", exception.Message);
        Assert.Contains("Int32", exception.Message);
        Assert.Contains("String", exception.Message);
    }
}
