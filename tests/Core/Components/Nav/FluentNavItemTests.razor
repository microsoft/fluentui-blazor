@using Bunit.TestDoubles
@using Microsoft.AspNetCore.Components.Authorization
@using Xunit
@using Microsoft.FluentUI.AspNetCore.Components
@inherits FluentUITestContext

@code {
	public FluentNavItemTests()
	{
		JSInterop.Mode = JSRuntimeMode.Loose;
		Services.AddFluentUIComponents();
	}

	[Fact]
	public void FluentNavItem_Renders_As_Link_When_Href_Provided()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavItem Href="https://example.com">Test Item</FluentNavItem>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("<a ", cut.Markup);
		Assert.Contains("href=\"https://example.com\"", cut.Markup);
		Assert.Contains("Test Item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_Renders_As_Button_When_No_Href_Provided()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavItem>Test Item</FluentNavItem>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("<button", cut.Markup);
		Assert.Contains("Test Item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_With_OnClick_Handler()
	{
		// Arrange & Act
		bool clicked = false;

		var cut = Render(@<FluentNav>
			<FluentNavItem OnClick="@(() => { clicked = true; })" Id="custom-id">Test Item</FluentNavItem>
			</FluentNav>
		);

		// Assert
		Assert.NotNull(cut);
		var button = cut.Find("#custom-id");
		button.Click();

		Assert.True(clicked);
	}

	[Fact]
	public void FluentNavItem_With_OnClick_Handler_And_Href()
	{
		var cut = Render(@<FluentNav>
			<FluentNavItem OnClick="@(() => { })" Href="https://example.com" Id="custom-id">Test Item</FluentNavItem>
			</FluentNav>
		);

		// Assert
		// Assert
		Assert.NotNull(cut);
		Assert.Contains("<a ", cut.Markup);
		Assert.Contains("href=\"https://example.com\"", cut.Markup);
		Assert.Contains("Test Item", cut.Markup);
	}

	// [Fact]
	// public void FluentNavItem_Renders_With_Active_State()
	// {
	// 	// Arrange & Act
	// 	var cut = Render(@<FluentNav>
	// 		<FluentNavItem Href="https://example.com" Active="true">Active Item</FluentNavItem>
	// 	</FluentNav>);

	// 	// Assert
	// 	Assert.NotNull(cut);
	// 	Assert.Contains("active", cut.Markup);
	// }

	[Fact]
	public void FluentNavItem_Renders_With_Disabled_State()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavItem Href="https://example.com" Disabled="true">Disabled Item</FluentNavItem>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("disabled", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_Renders_With_Disabled_State_As_Button()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavItem Disabled="true">Disabled Item</FluentNavItem>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("disabled", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_Renders_With_Disabled_State_As_Button_And_Clicked()
	{
		// Arrange & Act
		bool clicked = false;

		var cut = Render(@<FluentNav>
			<FluentNavItem Disabled="true" OnClick="@(() => { clicked = true; })" Id="custom-id">Test Item</FluentNavItem>
			</FluentNav>
		);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("disabled", cut.Markup);

		var button = cut.Find("#custom-id");
		button.Click();
		Assert.False(clicked);
	}

	[Fact]
	public void FluentNavItem_Renders_With_CustomClass()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavItem Href="https://example.com" Class="custom-nav-item">Test Item</FluentNavItem>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("custom-nav-item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_Throws_When_Not_Child_Of_Nav()
	{
		// Arrange - Create a derived FluentNav (which should fail the exact type check)
		var derivedNav = new DerivedFluentNav(Services.GetRequiredService<LibraryConfiguration>());

		// Arrange & Act & Assert
		var ex = Assert.Throws<InvalidOperationException>(() =>
		{
			Render(@<CascadingValue Value="derivedNav"><FluentNavItem Href="https://example.com">Test Item</FluentNavItem></CascadingValue>);
		});

		Assert.Contains("can only be used as a direct child of", ex.Message);
		Assert.Contains("FluentNav", ex.Message);
	}

	[Fact]
	public void FluentNavItem_Renders_With_Small_Density()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav Density="NavDensity.Small">
			<FluentNavItem Href="https://example.com">Test Item</FluentNavItem>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("density=", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_Renders_With_IconRest()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavItem IconRest="@Samples.Icons.Info">Test Item</FluentNavItem>
		</FluentNav>);
		// Assert
		Assert.NotNull(cut);
		Assert.Contains("<svg class=\"icon\" style=\"width: 24px;", cut.Markup);
		Assert.Contains("Test Item", cut.Markup);
	}

	// Renders without icon if FluentNav.UseIsons = false
	[Fact]
	public void FluentNavItem_Renders_Without_Icon_When_Not_UseIcons()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav UseIcons="false">
			<FluentNavItem IconRest="@Samples.Icons.Info">Test Item</FluentNavItem>
		</FluentNav>);
		// Assert
		Assert.NotNull(cut);
		Assert.DoesNotContain("<svg class=\"icon\"", cut.Markup);
		Assert.Contains("Test Item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_IsActive_When_Href_Matches_Current_URI()
	{
		// Arrange
		var navMan = Services.GetRequiredService<NavigationManager>();
		navMan.NavigateTo("https://localhost/test", true);

		var cut = Render(@<FluentNav>
			<FluentNavItem Id="link" IconRest="@Samples.Icons.Info" Href="https://localhost/test">Test Item</FluentNavItem>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);

		Assert.Contains("active", cut.Markup);
	}

		
	[Fact]
	public void FluentNavItem_IsActive_IconActive()
	{
		// Arrange
		var navMan = Services.GetRequiredService<NavigationManager>();
		navMan.NavigateTo("https://localhost/test", true);

		var cut = Render(@<FluentNav>
				<FluentNavItem Id="link" IconActive="@Samples.Icons.Warning" IconRest="@Samples.Icons.Info" Href="https://localhost/test">Test Item</FluentNavItem>
			</FluentNav>);

			// Assert
			Assert.NotNull(cut);

			cut.Verify();
	}

	[Fact]
	public void FluentNavItem_IsActive_WithoutIconActive()
	{
		// Arrange
		var navMan = Services.GetRequiredService<NavigationManager>();
		navMan.NavigateTo("https://localhost/test", true);

		var cut = Render(@<FluentNav>
				<FluentNavItem Id="link" IconRest="@Samples.Icons.Info" Href="https://localhost/test">Test Item</FluentNavItem>
			</FluentNav>);

			// Assert
			Assert.NotNull(cut);

			cut.Verify();
	}

	[Fact]
	public async Task FluentNavItem_DisposeAsync()
	{
		// Arrange & Act

		var calledTimes = 0;

		var cut = Render(@<FluentNav>
				<FluentNavItem Href="https://example.com">Test Item</FluentNavItem>
			</FluentNav>
		);

		// Assert
		await cut.FindComponent<FluentNavItem>().Instance.DisposeAsync();
		cut.Dispose();

		Assert.Equal(0, calledTimes);

	}

	// Tests for FluentNavItem when used as a subitem (within FluentNavCategory)

	[Fact]
	public void FluentNavItem_As_SubItem_Renders_As_Link_When_Href_Provided()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavCategory Title="Test Category">
				<FluentNavItem Href="https://example.com">Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("<a ", cut.Markup);
		Assert.Contains("href=\"https://example.com\"", cut.Markup);
		Assert.Contains("Sub Item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_As_SubItem_Renders_As_Button_When_No_Href_Provided()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavCategory Title="Test Category">
				<FluentNavItem>Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("<button", cut.Markup);
		Assert.Contains("Sub Item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_As_SubItem_Renders_With_Disabled_State()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavCategory Title="Test Category">
				<FluentNavItem Href="https://example.com" Disabled="true">Disabled Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("disabled", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_As_SubItem_Renders_With_CustomClass()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavCategory Title="Test Category">
				<FluentNavItem Href="https://example.com" Class="custom-sub-item">Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("custom-sub-item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_As_SubItem_Renders_With_Small_Density()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav Density="NavDensity.Small">
			<FluentNavCategory Title="Test Category">
				<FluentNavItem Href="https://example.com">Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>);

		// Assert
		Assert.NotNull(cut);
		Assert.Contains("density=", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_As_SubItem_Does_Not_Render_Icon()
	{
		// Arrange & Act
		var cut = Render(@<FluentNav>
			<FluentNavCategory Title="Test Category">
				<FluentNavItem IconRest="@Samples.Icons.Info">Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>
	);

		// Assert
		Assert.NotNull(cut);

		var i = cut.FindComponent<FluentNavItem>();
		Assert.DoesNotContain("<svg class=\"icon\"", i.Markup);
		Assert.Contains("Sub Item", cut.Markup);
	}

	[Fact]
	public void FluentNavItem_As_SubItem_Throws_When_Category_Is_Derived_Type()
	{
		// Arrange - Create a derived FluentNavCategory (which should fail the exact type check)
		var derivedCategory = new DerivedFluentNavCategory(Services.GetRequiredService<LibraryConfiguration>())
		{
			Owner = new FluentNav(Services.GetRequiredService<LibraryConfiguration>())
		};

		// Arrange & Act & Assert
		var ex = Assert.Throws<InvalidOperationException>(() =>
		{
			Render(@<CascadingValue Name="Category" Value="derivedCategory"><FluentNav><FluentNavItem Href="https://example.com">Sub Item</FluentNavItem></FluentNav></CascadingValue>);
		});

		Assert.Contains("can only be used as a direct child of", ex.Message);
		Assert.Contains("FluentNav", ex.Message);
	}

	[Fact]
	public void FluentNavItem_OnLocationChanged_Updates_Active_State()
	{
		// Arrange
		var navMan = Services.GetRequiredService<NavigationManager>();
		navMan.NavigateTo("https://localhost/other", true);

		var cut = Render(@<FluentNav>
			<FluentNavItem Id="link" Href="https://localhost/test">Test Item</FluentNavItem>
		</FluentNav>);

		// Assert initial state - should not be active
		Assert.DoesNotContain("active", cut.Find("#link").ClassName);

		// Act - Navigate to the matching URL
		navMan.NavigateTo("https://localhost/test", true);

		// Assert - should now be active after location change
		Assert.Contains("active", cut.Find("#link").ClassName);
	}

	[Fact]
	public void FluentNavItem_OnLocationChanged_Updates_Active_State_When_Navigating_Away()
	{
		// Arrange
		var navMan = Services.GetRequiredService<NavigationManager>();
		navMan.NavigateTo("https://localhost/test", true);

		var cut = Render(@<FluentNav>
			<FluentNavItem Id="link" Href="https://localhost/test">Test Item</FluentNavItem>
		</FluentNav>);

		// Assert initial state - should be active
		Assert.Contains("active", cut.Find("#link").ClassName);

		// Act - Navigate away from the matching URL
		navMan.NavigateTo("https://localhost/other", true);

		// Assert - should no longer be active after location change
		Assert.DoesNotContain("active", cut.Find("#link").ClassName);
	}

	[Fact]
	public void FluentNavItem_As_SubItem_OnLocationChanged_Notifies_Category()
	{
		// Arrange
		var navMan = Services.GetRequiredService<NavigationManager>();
		navMan.NavigateTo("https://localhost/other", true);

		var cut = Render(@<FluentNav>
			<FluentNavCategory Title="Test Category" Expanded="true">
				<FluentNavItem Id="sublink" Href="https://localhost/test">Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>);

		// Assert initial state - subitem should not be active
		var subItem = cut.FindComponent<FluentNavItem>();
		Assert.False(subItem.Instance.Active);

		// Act - Navigate to the matching URL
		navMan.NavigateTo("https://localhost/test", true);

		// Assert - subitem should now be active
		Assert.True(subItem.Instance.Active);
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Closes_Opened_Hamburger_Menu()
	{
		// Arrange - Create a layout with hamburger and nav item
		var cut = Render(@<FluentLayout Id="my-layout">
			<FluentLayoutItem Area="LayoutArea.Header">
				<FluentLayoutHamburger Id="my-hamburger" />
				Header
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Navigation">
				<FluentNav>
					<FluentNavItem Id="nav-item" Href="/test">Test Item</FluentNavItem>
				</FluentNav>
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Content">Content</FluentLayoutItem>
		</FluentLayout>);

		var hamburger = cut.FindComponent<FluentLayoutHamburger>();
		
		// Open the hamburger menu
		await hamburger.Instance.FluentLayout_HamburgerClickAsync(isExpanded: true);
		Assert.True(hamburger.Instance.IsOpened, "Hamburger should be opened");

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - Hamburger should be closed (HideAsync is called)
		// Note: Since HideAsync uses JS interop, we verify that the code path executed
		// The actual closing would happen via JS
		JSInterop.VerifyInvoke("Microsoft.FluentUI.Blazor.Components.Dialog.Hide");
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Closes_Multiple_Opened_Hamburger_Menus()
	{
		// Arrange - Create a layout with multiple hamburgers
		var cut = Render(@<FluentLayout Id="my-layout">
			<FluentLayoutItem Area="LayoutArea.Header">
				<FluentLayoutHamburger Id="hamburger-1" />
				<FluentLayoutHamburger Id="hamburger-2" />
				Header
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Navigation">
				<FluentNav>
					<FluentNavItem Id="nav-item" Href="/test">Test Item</FluentNavItem>
				</FluentNav>
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Content">Content</FluentLayoutItem>
		</FluentLayout>);

		var hamburgers = cut.FindComponents<FluentLayoutHamburger>();
		
		// Open both hamburger menus
		await hamburgers[0].Instance.FluentLayout_HamburgerClickAsync(isExpanded: true);
		await hamburgers[1].Instance.FluentLayout_HamburgerClickAsync(isExpanded: true);
		Assert.True(hamburgers[0].Instance.IsOpened, "Hamburger 1 should be opened");
		Assert.True(hamburgers[1].Instance.IsOpened, "Hamburger 2 should be opened");

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - Both hamburgers should have HideAsync called
		JSInterop.VerifyInvoke("Microsoft.FluentUI.Blazor.Components.Dialog.Hide", 2);
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Navigates_To_Href_When_Hamburger_Opened()
	{
		// Arrange - Create a layout with hamburger and nav item with href
		var navMan = Services.GetRequiredService<NavigationManager>();
		var initialUri = navMan.Uri;
		
		var cut = Render(@<FluentLayout Id="my-layout">
			<FluentLayoutItem Area="LayoutArea.Header">
				<FluentLayoutHamburger Id="my-hamburger" />
				Header
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Navigation">
				<FluentNav>
					<FluentNavItem Id="nav-item" Href="/test-page">Test Item</FluentNavItem>
				</FluentNav>
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Content">Content</FluentLayoutItem>
		</FluentLayout>);

		var hamburger = cut.FindComponent<FluentLayoutHamburger>();
		
		// Open the hamburger menu
		await hamburger.Instance.FluentLayout_HamburgerClickAsync(isExpanded: true);

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - Should navigate to the href
		Assert.EndsWith("/test-page", navMan.Uri);
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Opens_Link_With_Target_When_Hamburger_Opened()
	{
		// Arrange - Create a layout with hamburger and nav item with target
		var cut = Render(@<FluentLayout Id="my-layout">
			<FluentLayoutItem Area="LayoutArea.Header">
				<FluentLayoutHamburger Id="my-hamburger" />
				Header
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Navigation">
				<FluentNav>
					<FluentNavItem Id="nav-item" Href="https://example.com" Target="LinkTarget.Blank">External Link</FluentNavItem>
				</FluentNav>
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Content">Content</FluentLayoutItem>
		</FluentLayout>);

		var hamburger = cut.FindComponent<FluentLayoutHamburger>();
		
		// Open the hamburger menu
		await hamburger.Instance.FluentLayout_HamburgerClickAsync(isExpanded: true);

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - Should call window.open with target
		JSInterop.VerifyInvoke("window.open");
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Does_Not_Close_Hamburger_When_Not_Opened()
	{
		// Arrange - Create a layout with hamburger but don't open it
		var cut = Render(@<FluentLayout Id="my-layout">
			<FluentLayoutItem Area="LayoutArea.Header">
				<FluentLayoutHamburger Id="my-hamburger" />
				Header
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Navigation">
				<FluentNav>
					<FluentNavItem Id="nav-item" Href="/test">Test Item</FluentNavItem>
				</FluentNav>
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Content">Content</FluentLayoutItem>
		</FluentLayout>);

		var hamburger = cut.FindComponent<FluentLayoutHamburger>();
		Assert.False(hamburger.Instance.IsOpened, "Hamburger should not be opened");

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - HideAsync should not be called since hamburger wasn't opened
		// The navigation should still work normally without trying to close the hamburger
		// We verify that no Dialog.Hide was invoked
		var invocations = JSInterop.Invocations.Where(i => i.Identifier == "Microsoft.FluentUI.Blazor.Components.Dialog.Hide");
		Assert.Empty(invocations);
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Invokes_OnItemClick_Callback()
	{
		// Arrange
		FluentNavItem? clickedItem = null;
		
		var cut = Render(@<FluentNav OnItemClick="@((item) => clickedItem = item)">
			<FluentNavItem Id="nav-item" Href="/test">Test Item</FluentNavItem>
		</FluentNav>);

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - OnItemClick callback should have been invoked with the nav item
		Assert.NotNull(clickedItem);
		Assert.Equal("nav-item", clickedItem.Id);
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Invokes_Both_OnClick_And_OnItemClick()
	{
		// Arrange
		bool onClickCalled = false;
		FluentNavItem? clickedItem = null;
		
		var cut = Render(@<FluentNav OnItemClick="@((item) => clickedItem = item)">
			<FluentNavItem Id="nav-item" Href="/test" OnClick="@(() => onClickCalled = true)">Test Item</FluentNavItem>
		</FluentNav>);

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - Both callbacks should have been invoked
		Assert.True(onClickCalled, "OnClick should have been called");
		Assert.NotNull(clickedItem);
		Assert.Equal("nav-item", clickedItem.Id);
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_OnItemClick_With_Hamburger_Closes_Menu()
	{
		// Arrange - Test that OnItemClick is called before hamburger closes
		FluentNavItem? clickedItem = null;
		
		var cut = Render(@<FluentLayout Id="my-layout">
			<FluentLayoutItem Area="LayoutArea.Header">
				<FluentLayoutHamburger Id="my-hamburger" />
				Header
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Navigation">
				<FluentNav OnItemClick="@((item) => clickedItem = item)">
					<FluentNavItem Id="nav-item" Href="/test">Test Item</FluentNavItem>
				</FluentNav>
			</FluentLayoutItem>
			<FluentLayoutItem Area="LayoutArea.Content">Content</FluentLayoutItem>
		</FluentLayout>);

		var hamburger = cut.FindComponent<FluentLayoutHamburger>();
		
		// Open the hamburger menu
		await hamburger.Instance.FluentLayout_HamburgerClickAsync(isExpanded: true);

		// Act - Click the nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - OnItemClick should be called AND hamburger should close
		Assert.NotNull(clickedItem);
		Assert.Equal("nav-item", clickedItem.Id);
		JSInterop.VerifyInvoke("Microsoft.FluentUI.Blazor.Components.Dialog.Hide");
	}

	[Fact]
	public async Task FluentNavItem_OnClickHandlerAsync_Does_Not_Invoke_OnItemClick_When_Disabled()
	{
		// Arrange
		FluentNavItem? clickedItem = null;
		
		var cut = Render(@<FluentNav OnItemClick="@((item) => clickedItem = item)">
			<FluentNavItem Id="nav-item" Href="/test" Disabled="true">Test Item</FluentNavItem>
		</FluentNav>);

		// Act - Click the disabled nav item
		var navItem = cut.Find("#nav-item");
		await navItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - OnItemClick should NOT have been invoked
		Assert.Null(clickedItem);
	}

	[Fact]
	public async Task FluentNavItem_As_SubItem_OnClickHandlerAsync_Invokes_OnItemClick()
	{
		// Arrange
		FluentNavItem? clickedItem = null;
		
		var cut = Render(@<FluentNav OnItemClick="@((item) => clickedItem = item)">
			<FluentNavCategory Title="Test Category" Expanded="true">
				<FluentNavItem Id="sub-item" Href="/test">Sub Item</FluentNavItem>
			</FluentNavCategory>
		</FluentNav>);

		// Act - Click the sub item
		var subItem = cut.Find("#sub-item");
		await subItem.ClickAsync(new Microsoft.AspNetCore.Components.Web.MouseEventArgs());

		// Assert - OnItemClick callback should have been invoked
		Assert.NotNull(clickedItem);
		Assert.Equal("sub-item", clickedItem.Id);
	}
}
