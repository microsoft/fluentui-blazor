@using System.Globalization
@using Microsoft.FluentUI.AspNetCore.Components.Extensions
@using Xunit
@using Microsoft.FluentUI.AspNetCore.Components
@inherits Bunit.TestContext

@code
{
    private static readonly CultureInfo Culture_enUS = new("en-US");

    public FluentCalendarYearTests()
    {
        JSInterop.Mode = JSRuntimeMode.Loose;
        Services.AddFluentUIComponents();
    }

    [Fact]
    public void Constructor_InitializesYearCorrectly()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var calendarComponent = RenderComponent<FluentCalendar>();
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 6, 15);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.Equal(new DateTime(2023, 1, 1), fluentCalendarYear.Year);
    }

    [Fact]
    public void IsReadOnly_WhenCalendarIsReadOnly_ReturnsTrue()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var calendarComponent = RenderComponent<FluentCalendar>(parameters => parameters
            .Add(p => p.ReadOnly, true));
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.True(fluentCalendarYear.IsReadOnly);
    }

    [Fact]
    public void IsReadOnly_WhenCalendarIsDisabled_ReturnsTrue()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var calendarComponent = RenderComponent<FluentCalendar>(parameters => parameters
            .Add(p => p.Disabled, true));
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.True(fluentCalendarYear.IsReadOnly);
    }

    [Fact]
    public void IsDisabled_WhenYearIsDisabledByFunc_ReturnsTrue()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var calendarComponent = RenderComponent<FluentCalendar>(parameters => parameters
            .Add(p => p.DisabledDateFunc, (dt) => dt.Year == 2023));
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.True(fluentCalendarYear.IsDisabled);
        Assert.True(fluentCalendarYear.IsReadOnly);
    }

    [Fact]
    public void IsDisabled_WhenAllDaysOfYearAreDisabled_ReturnsTrue()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var calendarComponent = RenderComponent<FluentCalendar>(parameters => parameters
            .Add(p => p.DisabledCheckAllDaysOfMonthYear, true)
            .Add(p => p.DisabledDateFunc, (dt) => true));
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.True(fluentCalendarYear.IsDisabled);
        Assert.True(fluentCalendarYear.IsReadOnly);
    }

    [Fact]
    public void IsSelected_WhenYearIsSelected_ReturnsTrue()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var selectedDate = new DateTime(2023, 5, 10);
        var calendarComponent = RenderComponent<FluentCalendar>(parameters => parameters
            .Add(p => p.Value, selectedDate));
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.True(fluentCalendarYear.IsSelected);
    }

    [Fact]
    public void IsSelected_WhenYearIsNotSelected_ReturnsFalse()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var selectedDate = new DateTime(2024, 5, 10);
        var calendarComponent = RenderComponent<FluentCalendar>(parameters => parameters
            .Add(p => p.Value, selectedDate));
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.False(fluentCalendarYear.IsSelected);
    }

    [Fact]
    public void IsSelected_WhenValueIsNull_ReturnsFalse()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var calendarComponent = RenderComponent<FluentCalendar>(parameters => parameters
            .Add(p => p.Value, null));
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);

        // Assert
        Assert.False(fluentCalendarYear.IsSelected);
    }

    [Fact]
    public void YearIdentifier_ReturnsCorrectFormat()
    {
        using var context = new DateTimeProviderContext(DateTime.Now);

        // Arrange
        var calendarComponent = RenderComponent<FluentCalendar>();
        var calendar = calendarComponent.Instance;
        var date = new DateTime(2023, 1, 1);

        // Act
        var fluentCalendarYear = new FluentCalendarYear(calendar, date);
        var identifier = fluentCalendarYear.YearIdentifier;

        // Assert
        Assert.Equal("2023", identifier);
    }
}